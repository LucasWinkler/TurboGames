@page "/Settings/Payment"
@model PaymentModel
@{
    ViewData["Title"] = "Payment information";
    ViewData["ActivePage"] = ManageNavPages.Payment;
}

<h4>@ViewData["Title"]</h4>
<partial name="_StatusMessage" for="StatusMessage" />
<div class="row">
    <div class="col-md-6">
        <form id="billing-form" method="post">
            <div asp-validation-summary="All" class="text-danger"></div>
            <label asp-for="Payment.CardNumber"></label>
            <div class="form-group input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text"> <i id="cardType" class="fas fa-credit-card fa-2x"></i> </span>
                </div>
                <input asp-for="Payment.CardNumber" class="form-control" style="height: 3em" placeholder="Card number" type="text" autofocus>
            </div>
            <div class="form-row">
                <div class="col-7">
                    <label asp-for="Payment.CardExpirationDate"></label>
                    <div class="form-group input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> <i class="fas fa-calendar-alt"></i> </span>
                        </div>
                        <input asp-for="Payment.CardExpirationDate" placeholder="MM/YY" class="form-control">
                    </div>
                </div>
                <div class="col">
                    <label asp-for="Payment.CardCVC"></label>
                    <div class="form-group input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"> <i class="fas fa-lock"></i> </span>
                        </div>
                        <input asp-for="Payment.CardCVC" class="form-control" placeholder="Security code" type="text" maxlength="4">
                    </div>
                </div>
            </div>
            <label asp-for="Payment.CardName"></label>
            <div class="form-group input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text"> <i class="fas fa-user"></i> </span>
                </div>
                <input asp-for="Payment.CardName" class="form-control" placeholder="Card name" type="text">
            </div>
            <div class="form-row">
                <div class="col">
                    <button id="update-payment-button" type="submit" class="btn btn-primary btn-block">Save</button>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function () {
             var cardType = IsValidCreditCardNumber($("#Payment_CardNumber").val());

                $('#cardType').removeClass();
                $('#cardType').addClass(cardType);
            $("#Payment_CardNumber").on('input', function () {
                var cardType = IsValidCreditCardNumber($("#Payment_CardNumber").val());

                $('#cardType').removeClass();
                $('#cardType').addClass(cardType);
            });

            function AmexCardnumber(cardNumber) {
                var regex = /^(?:3[47][0-9]{13})$/;
                return regex.test(cardNumber);
            }

            function VisaCardnumber(cardNumber) {
                var regex = /^(?:4[0-9]{12}(?:[0-9]{3})?)$/;
                return regex.test(cardNumber);
            }

            function MasterCardnumber(cardNumber) {
                var regex = /^(?:5[1-5][0-9]{14})$/;
                return regex.test(cardNumber);
            }

            function DiscoverCardnumber(cardNumber) {
                var regex = /^(?:6(?:011|5[0-9][0-9])[0-9]{12})$/;
                return regex.test(cardNumber);
            }

            function DinerClubCardnumber(cardNumber) {
                var regex = /^(?:3(?:0[0-5]|[68][0-9])[0-9]{11})$/;
                return regex.test(cardNumber);
            }

            function JCBCardnumber(cardNumber) {
                var regex = /^(?:(?:2131|1800|35\d{3})\d{11})$/;
                return regex.test(cardNumber);
            }

            function IsValidCreditCardNumber(cardNumber) {

                var cardType = null;

                if (VisaCardnumber(cardNumber)) {
                    cardType = "visa";
                } else if (MasterCardnumber(cardNumber)) {
                    cardType = "mastercard";
                } else if (AmexCardnumber(cardNumber)) {
                    cardType = "amex";
                } else if (DiscoverCardnumber(cardNumber)) {
                    cardType = "discover";
                } else if (DinerClubCardnumber(cardNumber)) {
                    cardType = "diners-club";
                } else if (JCBCardnumber(cardNumber)) {
                    cardType = "jcb";
                }

                return cardType !== null ? 'fab fa-cc-' + cardType + ' fa-2x' : 'fas fa-credit-card fa-2x';
            }
        });
    </script>
}